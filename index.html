<!doctype html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width">
  <title>[##_page_title_##]</title>
  <link rel="alternate" type="application/rss+xml" title="[##_title_##]" href="[##_rss_url_##]" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&family=Ubuntu+Mono:wght@400;700&family=Fira+Code:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.19.0/js/md5.min.js"></script>

  <!-- Highlight.js (코드 신택스 하이라이팅) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

  <link rel="stylesheet" href="./style.css">
  <link rel="stylesheet" href="./images/font.css">
  <style>
    /* 홈화면 데스크탑 모드: 블로그 본문 전체 숨김 (데스크탑 오버레이가 덮음) */
    #tt-body-index #dkWrap { visibility: hidden; }
    /* 인덱스 페이지: JS 실행 전에도 즉시 데스크탑 표시 (flash 방지) */
    #tt-body-index #dyoDesktop { display: flex; }

    <s_if_var_cover-image>.wrap_sub {
      background-image: url('[##_var_cover-image_##]');
    }
    </s_if_var_cover-image>
  </style>

  <!--[if lt IE 9]>
  <script src="//t1.daumcdn.net/tistory_admin/lib/jquery/jquery-1.12.4.min.js"></script>
  <![endif]-->
  <!--[if gte IE 9]><!-->
  <script src="//t1.daumcdn.net/tistory_admin/lib/jquery/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <!--<![endif]-->
</head>

<body id="[##_body_id_##]">
  <s_t3>

    <div id="dkIndex">
      <a href="#dkBody">본문 바로가기</a>
    </div>

    <div id="dkWrap" class="wrap_skin">
      <div id="dkHead" role="banner" class="area_head">
        <h1 class="screen_out">[##_title_##]</h1>
        <button type="button" class="btn_cate">
          <span class="ico_skin ico_cate">카테고리</span>
        </button>

        <div class="area_search">
          <button type="button" class="btn_search">
            <span class="ico_search">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
            </span>
          </button>
          <s_search>
            <form action="#" method="get" class="frm_search box_search" onsubmit="[##_search_onclick_submit_##]">
              <fieldset>
                <legend class="screen_out">검색하기</legend>
                <label for="[##_search_name_##]" class="lab_search screen_out">블로그 내 검색</label>
                <input type="text" name="[##_search_name_##]" id="[##_search_name_##]" class="tf_search"
                  placeholder="grep -r &quot;keyword&quot;" value="[##_search_text_##]" data-value="[##_search_text_##]">
              </fieldset>
            </form>
          </s_search>
        </div>

        <div class="area_profile">
          <div class="terminal-prompt">
            <span class="prompt-symbol">~$</span>
            <span class="prompt-cmd">whoami</span>
          </div>
          <div class="tit_post">
            <a href="/" class="link_post">[##_title_##]</a>
          </div>
          <a href="/category" class="thumb_profile">
            <img src="[##_image_##]" class="img_profile" alt="프로필사진">
          </a>
          <span class="txt_profile">[##_blogger_##]</span>
          <div class="typing-line">
            <span class="typing-prompt">~$</span>
            <span class="typing-text" id="typingText"></span>
            <span class="typing-cursor"></span>
          </div>
        </div>
      </div>

      <hr class="hide">

      <div id="dkContent" class="cont_skin" role="main">
        <div id="cMain">
          <div id="mFeature" class="wrap_sub">
            <div class="cont_sub">
              <div class="inner_sub">
                <div class="area_sub">
                  <div role="navigation" class="area_navi">
                    [##_category_list_##]
                    <a href="[##_guestbook_link_##]" class="link_guestbook">Guestbook</a>
                  </div>
                  <div class="wrap_etc">
                    <div class="col_aside left_side">
                      <s_sidebar>
                        <s_sidebar_element>
                          <s_rct_notice>
                            <div class="box_aside">
                              <strong class="tit_aside"><span class="aside-icon">&#9654;</span> Notice</strong>
                              <ul class="list_board">
                                <s_rct_notice_rep>
                                  <li><a href="[##_notice_rep_link_##]" class="link_board">[##_notice_rep_title_##]</a></li>
                                </s_rct_notice_rep>
                              </ul>
                            </div>
                          </s_rct_notice>
                        </s_sidebar_element>

                        <s_sidebar_element>
                          <div class="box_aside">
                            <strong class="tit_aside"><span class="aside-icon">&#9654;</span> Recent Posts</strong>
                            <ul class="list_board">
                              <s_rctps_rep>
                                <li><a href="[##_rctps_rep_link_##]" class="link_board">[##_rctps_rep_title_##]</a></li>
                              </s_rctps_rep>
                            </ul>
                          </div>
                        </s_sidebar_element>

                        <s_sidebar_element>
                          <div class="box_aside">
                            <strong class="tit_aside"><span class="aside-icon">&#9654;</span> Recent Comments</strong>
                            <ul class="list_board">
                              <s_rctrp_rep>
                                <li><a href="[##_rctrp_rep_link_##]" class="link_board">[##_rctrp_rep_desc_##]</a></li>
                              </s_rctrp_rep>
                            </ul>
                          </div>
                        </s_sidebar_element>

                        <s_sidebar_element>
                          <div class="box_aside">
                            <strong class="tit_aside"><span class="aside-icon">&#9654;</span> Link</strong>
                            <ul class="list_board">
                              <s_link_rep>
                                <li><a href="[##_link_url_##]" class="link_board" target="_blank">[##_link_site_##]</a></li>
                              </s_link_rep>
                            </ul>
                          </div>
                        </s_sidebar_element>
                      </s_sidebar>
                    </div>

                    <div class="col_aside right_side">
                      <s_sidebar>
                        <s_sidebar_element>
                          <div class="box_aside box_calendar">
                            [##_calendar_##]
                          </div>
                        </s_sidebar_element>

                        <s_sidebar_element>
                          <div class="box_aside box_tag">
                            <strong class="tit_aside"><span class="aside-icon">&#9654;</span> Tags</strong>
                            <ul class="list_tag">
                              <s_random_tags>
                                <li><a href="[##_tag_link_##]" class="link_tag [##_tag_class_##]">[##_tag_name_##]</a></li>
                              </s_random_tags>
                            </ul>
                            <a href="[##_taglog_link_##]" class="link_more">more</a>
                          </div>
                        </s_sidebar_element>

                        <s_sidebar_element>
                          <div class="box_aside box_archive">
                            <strong class="tit_aside"><span class="aside-icon">&#9654;</span> Archives</strong>
                            <ul class="list_keep">
                              <s_archive_rep>
                                <li><a href="[##_archive_rep_link_##]" class="link_keep">[##_archive_rep_date_##]</a>
                                  ([##_archive_rep_count_##])</li>
                              </s_archive_rep>
                            </ul>
                          </div>
                        </s_sidebar_element>

                        <s_sidebar_element>
                          <div class="box_aside box_visitor">
                            <dl class="list_visitor">
                              <dt>Today</dt>
                              <dd>[##_count_today_##]</dd>
                            </dl>
                            <dl class="list_total">
                              <dt>Total</dt>
                              <dd>[##_count_total_##]</dd>
                            </dl>
                          </div>
                        </s_sidebar_element>
                      </s_sidebar>
                    </div>
                  </div>
                </div>
              </div>
              <button type="button" class="btn_close">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
              </button>

              <ul class="list_control">
                <li>
                  <button type="button" id="btnShell" title="Terminal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"></polyline><line x1="12" y1="19" x2="20" y2="19"></line></svg>
                  </button>
                </li>
              </ul>
            </div>
          </div>

          <div id="mArticle" class="article_skin">

            <s_list>
              <div class="list_title">
                <h2 id="dkBody" class="tit_skin"><span class="screen_out">목록</span><span
                    class="txt_title">[##_list_conform_##] <span class="count-badge">([##_list_count_##])</span></span></h2>
              </div>
            </s_list>

            <div class="index_title">
              <h2 class="tit_skin"><span class="txt_title">[##_title_##]</span></h2>
            </div>

            <s_article_rep>
              <s_index_article_rep>
                <div class="list_content">
                  <s_article_rep_thumbnail>
                    <a href="[##_article_rep_link_##]" class="thumbnail_post"
                      data-tiara-action-name="블로그글_클릭"
                      data-tiara-action-kind="ClickContent"
                      data-tiara-copy="[##_article_rep_title_##]"
                      data-tiara-image="[##_article_rep_thumbnail_url_##]"
                      data-tiara-click_url="[##_blog_link_##][##_article_rep_link_##]"
                      data-tiara-name="[##_article_rep_title_##]"
                      data-tiara-provider="[##_title_##]"
                      data-tiara-plink="[##_article_rep_link_##]"
                      data-tiara-id="[##_article_rep_link_##]"
                    ><img src="[##_article_rep_thumbnail_url_##]" alt="[##_article_rep_title_##]"></a>
                  </s_article_rep_thumbnail>
                  <a href="[##_article_rep_link_##]" class="link_post"
                    data-tiara-action-name="블로그글_클릭"
                    data-tiara-action-kind="ClickContent"
                    data-tiara-copy="[##_article_rep_title_##]"
                    data-tiara-image="[##_article_rep_thumbnail_url_##]"
                    data-tiara-click_url="[##_blog_link_##][##_article_rep_link_##]"
                    data-tiara-name="[##_article_rep_title_##]"
                    data-tiara-provider="[##_title_##]"
                    data-tiara-plink="[##_article_rep_link_##]"
                    data-tiara-id="[##_article_rep_link_##]"
                  >
                    <strong class="tit_post">[##_article_rep_title_##]</strong>
                    <p class="txt_post">[##_article_rep_summary_##]</p>
                  </a>
                  <div class="detail_info">
                    <a href="[##_article_rep_category_link_##]" class="link_cate">[##_article_rep_category_##]</a>
                    <span class="txt_bar"></span>
                    <span class="txt_date">[##_article_rep_date_##]</span>
                  </div>
                </div>
              </s_index_article_rep>

              <s_permalink_article_rep>
                <h2 id="dkBody" class="screen_out">[##_article_rep_title_##] 본문</h2>
                <div class="area_title">
                  <strong class="tit_category"><a
                      href="[##_article_rep_category_link_##]">[##_article_rep_category_##]</a></strong>
                  <h3 class="tit_post">[##_article_rep_title_##]</h3>
                  <span class="info_post">
                    <span class="post-meta-item">[##_article_rep_author_##]</span>
                    <span class="txt_bar"></span>
                    <span class="post-meta-item">[##_article_rep_date_##]</span>
                    [##_s_ad_isolation_##]
                  </span>
                </div>

                <div class="area_view" id="article-view">
                  [##_article_rep_desc_##]
                </div>
                <div class="area_etc">
                  <s_tag_label>
                    <dl class="list_tag">
                      <dt>Tag</dt>
                      <dd>[##_tag_label_rep_##]</dd>
                    </dl>
                  </s_tag_label>
                </div>

                <s_article_related>
                  <div class="area_related">
                    <strong class="tit_related">'[##_article_rep_category_##]' Related Articles</strong>
                    <ul class="list_related">
                      <s_article_related_rep>
                        <li class="[##_article_related_rep_type_##]">
                          <a href="[##_article_related_rep_link_##]" class="link_related">
                            <s_article_related_rep_thumbnail>
                              <span class="thumb_related">
                                <img src="[##_article_related_rep_thumbnail_link_##]"
                                  class="img_related" alt="">
                              </span>
                            </s_article_related_rep_thumbnail>
                            <span class="txt_related">[##_article_related_rep_title_##]</span>
                            <span class="date_related">[##_article_related_rep_date_##]</span>
                            <span class="frame_related"></span>
                          </a>
                        </li>
                      </s_article_related_rep>
                    </ul>
                    <a href="[##_article_rep_category_link_##]" class="link_more">more</a>
                  </div>
                </s_article_related>

                <div class="area_reply">
                  <s_rp>
                    [##_comment_group_##]
                  </s_rp>
                </div>
              </s_permalink_article_rep>
            </s_article_rep>

            <s_page_rep>
              <s_permalink_article_rep>
                <h2 id="dkBody" class="screen_out">[##_article_rep_title_##] 본문</h2>
                <div class="area_title">
                  <h3 class="tit_post">[##_article_rep_title_##]</h3>
                </div>
                <div class="area_view" id="article-view">
                  [##_article_rep_desc_##]
                </div>
              </s_permalink_article_rep>
            </s_page_rep>

            <s_notice_rep>
              <s_index_article_rep>
                <div class="list_content">
                  <a href="[##_notice_rep_link_##]" class="link_post"
                    data-tiara-action-name="공지목록글_클릭"
                    data-tiara-action-kind="ClickContent"
                    data-tiara-copy="[##_notice_rep_title_##]"
                    data-tiara-image="[##_notice_rep_thumbnail_url_##]"
                    data-tiara-click_url="[##_blog_link_##][##_notice_rep_link_##]"
                    data-tiara-name="[##_notice_rep_title_##]"
                    data-tiara-provider="[##_title_##]"
                    data-tiara-plink="[##_notice_rep_link_##]"
                    data-tiara-id="[##_notice_rep_link_##]"
                  >
                    <strong class="tit_post">[##_notice_rep_title_##]</strong>
                    <p class="txt_post">[##_notice_rep_summary_##]</p>
                  </a>
                  <div class="detail_info">
                    <a href="/notice" class="link_cate">공지사항</a>
                    <span class="txt_bar"></span> [##_notice_rep_date_##]
                  </div>
                </div>
              </s_index_article_rep>

              <s_permalink_article_rep>
                <h2 id="dkBody" class="screen_out">[##_notice_rep_title_##] 본문</h2>
                <div class="area_title">
                  <strong class="tit_category"><a href="/notice">공지사항</a></strong>
                  <h3 class="tit_post">[##_notice_rep_title_##]</h3>
                  <span class="info_post">[##_notice_rep_author_##]
                    <span class="txt_bar"></span>[##_notice_rep_date_##]</span>
                </div>
                <div class="area_view" id="article-view">
                  [##_notice_rep_desc_##]
                </div>
              </s_permalink_article_rep>
            </s_notice_rep>

            <s_article_protected>
              <s_index_article_rep>
                <div class="list_content">
                  <a href="[##_article_rep_link_##]" class="link_post"
                    data-tiara-action-name="블로그글_클릭"
                    data-tiara-action-kind="ClickContent"
                    data-tiara-copy="[##_article_rep_title_##]"
                    data-tiara-image="[##_article_rep_thumbnail_url_##]"
                    data-tiara-click_url="[##_blog_link_##][##_article_rep_link_##]"
                    data-tiara-name="[##_article_rep_title_##]"
                    data-tiara-provider="[##_title_##]"
                    data-tiara-plink="[##_article_rep_link_##]"
                    data-tiara-id="[##_article_rep_link_##]"
                  >
                    <strong class="tit_post">[##_article_rep_title_##]</strong>
                    <p class="txt_post">보호되어 있는 글입니다.</p>
                  </a>
                  <div class="detail_info">
                    <a href="[##_article_rep_category_link_##]" class="link_cate">[##_article_rep_category_##]</a>
                    <span class="txt_bar"></span> [##_article_rep_date_##]
                  </div>
                </div>
              </s_index_article_rep>

              <s_permalink_article_rep>
                <h2 id="dkBody" class="screen_out">[##_article_rep_title_##] 본문</h2>
                <div class="area_title">
                  <strong class="tit_category"><a
                      href="[##_article_rep_category_link_##]">[##_article_rep_category_##]</a></strong>
                  <h3 class="tit_post">[##_article_rep_title_##]</h3>
                  <span class="info_post">[##_article_rep_author_##]
                    <span class="txt_bar"></span>[##_article_rep_date_##]</span>
                </div>
                <form class="protected_form" onsubmit="[##_article_dissolve_##]">
                  <p>보호되어 있는 글입니다.<br>내용을 보시려면 비밀번호를 입력하세요.</p>
                  <input type="password" id="[##_article_password_##]" name="[##_article_password_##]" value=""
                    placeholder="비밀번호" />
                  <button type="submit">확인</button>
                </form>
              </s_permalink_article_rep>
            </s_article_protected>

            <s_tag>
              <h2 id="dkBody" class="tit_skin"><span class="txt_title">Tags</span></h2>
              <ul class="list_tag">
                <s_tag_rep>
                  <li><a href="[##_tag_link_##]" class="link_tag [##_tag_class_##]">[##_tag_name_##]</a></li>
                </s_tag_rep>
              </ul>
            </s_tag>

            <s_guest>
              [##_guestbook_group_##]
            </s_guest>

            <s_paging>
              <div class="area_paging">
                <span class="inner_paging">
                  <a [##_prev_page_##] class="btn_prev [##_no_more_prev_##]">
                    <span class="ico_prev">&larr;</span> Prev
                  </a>
                  <s_paging_rep>
                    <a [##_paging_rep_link_##] class="link_page">[##_paging_rep_link_num_##]</a>
                  </s_paging_rep>
                  <a [##_next_page_##] class="btn_next [##_no_more_next_##]">
                    Next <span class="ico_next">&rarr;</span>
                  </a>
                </span>
              </div>
            </s_paging>
          </div>
        </div>
      </div>

      <hr class="hide">

      <div id="dkFoot" role="contentinfo" class="area_foot">
        <small class="info_copyright">
          <span class="footer-prompt">$</span> echo "Powered by
          <a href="http://www.kakaocorp.com" class="emph_t" target="_blank">Kakao</a> // Designed by
          <a href="https://dyomyo.tistory.com" class="emph_t" target="_blank">Doyoucode</a>"
        </small>
      </div>
    </div>

    <!-- 스크롤 진행바 -->
    <div class="scroll-progress" id="scrollProgress"></div>

    <!-- 맨 위로 가기 버튼 -->
    <button type="button" class="btn-scroll-top" id="btnScrollTop" title="맨 위로">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m18 15-6-6-6 6"/></svg>
    </button>

    <!-- 데스크탑 홈화면 (인덱스 페이지 전용) -->
    <div class="dyo-desktop" id="dyoDesktop">
      <div class="dyo-desktop-grid">

        <!-- README 아이콘 -->
        <div class="dyo-desktop-icon" id="desktopIconReadme" title="README">
          <div class="dyo-di-wrap">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" fill="#3b82f6" opacity="0.15"/>
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" fill="none" stroke="#3b82f6" stroke-width="1.5" stroke-linejoin="round"/>
              <polyline points="14 2 14 8 20 8" fill="none" stroke="#3b82f6" stroke-width="1.5" stroke-linejoin="round"/>
              <line x1="8" y1="12" x2="16" y2="12" stroke="#3b82f6" stroke-width="1.4"/>
              <line x1="8" y1="15" x2="16" y2="15" stroke="#3b82f6" stroke-width="1.4" opacity="0.65"/>
              <line x1="8" y1="18" x2="13" y2="18" stroke="#3b82f6" stroke-width="1.4" opacity="0.4"/>
            </svg>
          </div>
          <span class="dyo-di-label">README</span>
        </div>

        <!-- Terminal 아이콘 (Windows CMD 스타일) -->
        <div class="dyo-desktop-icon" id="desktopIconShell" title="Terminal">
          <div class="dyo-di-wrap">
            <!-- CMD: > prompt + _ cursor -->
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="square" stroke-linejoin="miter" stroke-width="2.5">
              <polyline points="4 8 9 12 4 16"></polyline>
              <line x1="12" y1="16" x2="20" y2="16"></line>
            </svg>
          </div>
          <span class="dyo-di-label">Command Prompt</span>
        </div>

        <!-- Dev Blog 아이콘 (Tistory) -->
        <div class="dyo-desktop-icon" id="desktopIconBlog" title="Dev Blog">
          <div class="dyo-di-wrap">
            <!-- Tistory T 로고 -->
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <rect x="3.5" y="6" width="17" height="3.2" rx="1.6" fill="white"/>
              <rect x="10.4" y="8.8" width="3.2" height="10.2" rx="1.6" fill="white"/>
            </svg>
          </div>
          <span class="dyo-di-label">Dev Blog</span>
        </div>

        <!-- GitHub 아이콘 -->
        <div class="dyo-desktop-icon" id="desktopIconGithub" title="GitHub">
          <div class="dyo-di-wrap">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.17 6.839 9.49.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.604-3.369-1.34-3.369-1.34-.454-1.156-1.11-1.464-1.11-1.464-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.741 0 .267.18.578.688.48C19.138 20.167 22 16.418 22 12c0-5.523-4.477-10-10-10z"/>
            </svg>
          </div>
          <span class="dyo-di-label">GitHub</span>
        </div>

        <!-- Guestbook 채팅 아이콘 -->
        <div class="dyo-desktop-icon" id="desktopIconGuest" title="Guestbook">
          <div class="dyo-di-wrap">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" fill="#FEE500" opacity="0.25" stroke="#c8a800" stroke-width="1.5" stroke-linejoin="round"/>
              <circle cx="8.5" cy="11" r="1.2" fill="#c8a800"/>
              <circle cx="12" cy="11" r="1.2" fill="#c8a800"/>
              <circle cx="15.5" cy="11" r="1.2" fill="#c8a800"/>
            </svg>
          </div>
          <span class="dyo-di-label">Guestbook</span>
        </div>


      </div>

      <!-- 하단 태스크바 -->
      <div class="dyo-desktop-bar">
        <span class="dyo-bar-left">guest@doyoucode:~$</span>
        <div class="dyo-bar-right">
          <span id="desktopClock">00:00</span>
          <span id="desktopDate">----/--/--</span>
        </div>
      </div>
    </div>

    <!-- 가상 브라우저 창 (드래그 가능) -->
    <div class="dyo-browser-win" id="dyoBrowserWin">
      <div class="dyo-browser-titlebar" id="dyoBrowserTitlebar">
        <span class="dyo-term-dot red"    id="dyoBrowserClose" title="닫기"></span>
        <span class="dyo-term-dot yellow" id="dyoBrowserMin"   title="최소화"></span>
        <span class="dyo-term-dot green"  id="dyoBrowserMax"   title="최대화"></span>
        <div class="dyo-browser-navarea">
          <button class="dyo-browser-navbtn" id="dyoBrowserBack"   title="뒤로">&#8592;</button>
          <button class="dyo-browser-navbtn" id="dyoBrowserFwd"    title="앞으로">&#8594;</button>
          <div class="dyo-browser-urlbar" id="dyoBrowserUrl">about:blank</div>
          <button class="dyo-browser-navbtn" id="dyoBrowserReload" title="새로고침">&#8635;</button>
        </div>
      </div>
      <iframe class="dyo-browser-frame" id="dyoBrowserFrame" src="about:blank"></iframe>
      <div class="dyo-brs-handle n"  data-dir="n"></div>
      <div class="dyo-brs-handle ne" data-dir="ne"></div>
      <div class="dyo-brs-handle e"  data-dir="e"></div>
      <div class="dyo-brs-handle se" data-dir="se"></div>
      <div class="dyo-brs-handle s"  data-dir="s"></div>
      <div class="dyo-brs-handle sw" data-dir="sw"></div>
      <div class="dyo-brs-handle w"  data-dir="w"></div>
      <div class="dyo-brs-handle nw" data-dir="nw"></div>
    </div>

    <!-- 가상 터미널 창 (드래그 가능) -->
    <div class="dyo-shell-win" id="dyoShellWin">
      <div class="dyo-shell-titlebar" id="dyoShellTitlebar">
        <span class="dyo-term-dot red"    id="dyoShellClose"  title="닫기"></span>
        <span class="dyo-term-dot yellow" id="dyoShellMin"    title="최소화"></span>
        <span class="dyo-term-dot green"  id="dyoShellMax"    title="최대화"></span>
        <span class="dyo-shell-title">guest@blog: ~</span>
      </div>
      <div class="dyo-term-body" id="termOutput">
        <div class="dyo-term-banner">╔════════════════════════════════════════╗
║  Welcome to doyoucode's terminal       ║
║  Type '<span class="tr-cmd">help</span>' to see available commands ║
╚════════════════════════════════════════╝</div>
        <form class="dyo-term-input-row" id="dyoTermForm" onsubmit="return false;">
          <span class="dyo-term-prompt">[doyoucode@guest ~]$&nbsp;</span>
          <input class="dyo-term-input" id="termInput" type="text"
            autocomplete="off" spellcheck="false"
            placeholder="type a command...">
        </form>
      </div>
      <div class="dyo-brs-handle n"  data-dir="n"></div>
      <div class="dyo-brs-handle ne" data-dir="ne"></div>
      <div class="dyo-brs-handle e"  data-dir="e"></div>
      <div class="dyo-brs-handle se" data-dir="se"></div>
      <div class="dyo-brs-handle s"  data-dir="s"></div>
      <div class="dyo-brs-handle sw" data-dir="sw"></div>
      <div class="dyo-brs-handle w"  data-dir="w"></div>
      <div class="dyo-brs-handle nw" data-dir="nw"></div>
    </div>

    <!-- README 창 -->
    <div class="dyo-shell-win" id="dyoReadmeWin">
      <div class="dyo-shell-titlebar" id="dyoReadmeTitlebar">
        <span class="dyo-term-dot red"    id="dyoReadmeClose" title="닫기"></span>
        <span class="dyo-term-dot yellow" id="dyoReadmeMin"   title="최소화"></span>
        <span class="dyo-term-dot green"  id="dyoReadmeMax"   title="최대화"></span>
        <span class="dyo-shell-title">README.md</span>
      </div>
      <div class="dyo-term-body" style="overflow-y:auto;padding:20px 24px">
        <div style="font-family:'Noto Sans KR','Apple SD Gothic Neo',-apple-system,sans-serif;font-size:13px;line-height:1.85;color:#abb2bf">

          <div style="color:#e6e6e6;font-size:15px;font-weight:700;margin-bottom:2px"># doyoucode · README</div>
          <div style="color:#5c6370;font-size:12px;margin-bottom:22px">개발자 테마의 Tistory 블로그 · 데스크탑 UI + 터미널 인터페이스</div>

          <div style="color:#98c379;font-weight:600;margin-bottom:8px">## 데스크탑 아이콘</div>
          <div style="display:grid;grid-template-columns:auto 1fr;gap:2px 12px;padding-left:12px;margin-bottom:22px">
            <span style="color:#61afef">README</span><span>이 도움말 페이지</span>
            <span style="color:#61afef">Terminal</span><span>터미널 창 열기</span>
            <span style="color:#61afef">Dev Blog</span><span>전체 포스트 보기 (브라우저 창)</span>
            <span style="color:#61afef">Guestbook</span><span>방명록 채팅 / 메시지 남기기</span>
            <span style="color:#61afef">GitHub</span><span>GitHub 프로필 새 탭으로 열기</span>
          </div>

          <div style="color:#98c379;font-weight:600;margin-bottom:8px">## 터미널 명령어</div>
          <div style="display:grid;grid-template-columns:auto 1fr;gap:2px 12px;padding-left:12px;margin-bottom:22px">
            <span style="color:#61afef">help</span><span>명령어 목록 보기</span>
            <span style="color:#61afef">about / whoami</span><span>블로그 소개</span>
            <span style="color:#61afef">ls</span><span>카테고리 목록</span>
            <span style="color:#61afef">cd [카테고리]</span><span>카테고리로 이동</span>
            <span style="color:#61afef">search [검색어]</span><span>포스트 검색</span>
            <span style="color:#61afef">date</span><span>현재 날짜/시간</span>
            <span style="color:#61afef">echo [텍스트]</span><span>텍스트 출력</span>
            <span style="color:#61afef">github</span><span>GitHub 열기</span>
            <span style="color:#61afef">clear</span><span>터미널 초기화</span>
            <span style="color:#61afef">exit</span><span>터미널 창 닫기</span>
          </div>

          <div style="color:#98c379;font-weight:600;margin-bottom:8px">## 브라우저 창</div>
          <div style="padding-left:12px;margin-bottom:22px">
            <div>드래그로 이동 / 모서리로 크기 조절</div>
            <div>닫기(빨강) · 최소화(노랑) · 최대화(초록)</div>
            <div>뒤로 · 앞으로 · 새로고침 지원</div>
          </div>

          <div style="color:#98c379;font-weight:600;margin-bottom:8px">## Guestbook <span style="color:#5c6370;font-weight:400;font-size:12px">(방명록 채팅)</span></div>
          <div style="padding-left:12px;margin-bottom:22px">
            <div>카카오톡 스타일 채팅 인터페이스</div>
            <div>방문자 메시지 → 오른쪽 노란 말풍선</div>
            <div>관리자 답글 → 왼쪽 흰 말풍선</div>
            <div>이름 + 비밀번호 입력 후 메시지 전송</div>
            <div style="color:#5c6370">Ctrl+Enter 로 빠른 전송</div>
          </div>

          <div style="color:#98c379;font-weight:600;margin-bottom:8px">## 관리자 메뉴 <span style="color:#5c6370;font-weight:400;font-size:12px">(메인화면 우하단)</span></div>
          <div style="display:grid;grid-template-columns:auto 1fr;gap:2px 12px;padding-left:12px">
            <span style="color:#61afef">글쓰기</span><span>새 포스트 작성</span>
            <span style="color:#61afef">관리</span><span>Tistory 관리 페이지</span>
          </div>

        </div>
      </div>
      <div class="dyo-brs-handle n"  data-dir="n"></div>
      <div class="dyo-brs-handle ne" data-dir="ne"></div>
      <div class="dyo-brs-handle e"  data-dir="e"></div>
      <div class="dyo-brs-handle se" data-dir="se"></div>
      <div class="dyo-brs-handle s"  data-dir="s"></div>
      <div class="dyo-brs-handle sw" data-dir="sw"></div>
      <div class="dyo-brs-handle w"  data-dir="w"></div>
      <div class="dyo-brs-handle nw" data-dir="nw"></div>
    </div>

    <!-- Guestbook 채팅창 -->
    <div class="dyo-shell-win" id="dyoGuestWin">
      <div class="dyo-shell-titlebar" id="dyoGuestTitlebar">
        <span class="dyo-term-dot red"    id="dyoGuestClose" title="닫기"></span>
        <span class="dyo-term-dot yellow" id="dyoGuestMin"   title="최소화"></span>
        <span class="dyo-term-dot green"  id="dyoGuestMax"   title="최대화"></span>
        <span class="dyo-shell-title">Guestbook</span>
      </div>
      <div class="dyo-guest-kakaohdr">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" fill="#3b1e08" opacity="0.6"/></svg>
        <span>방명록</span>
        <button class="dyo-guest-reload" id="dyoGuestReload" title="새로고침">↺</button>
      </div>
      <div class="dyo-guest-body" id="dyoGuestBody">
        <div class="dyo-guest-loading" id="dyoGuestLoading">
          <div class="dyo-guest-spinner"></div>
          <span>방명록 불러오는 중...</span>
        </div>
        <div class="dyo-guest-chat" id="dyoGuestChat" style="display:none"></div>
      </div>
      <div class="dyo-guest-footer" id="dyoGuestFooter">
        <div class="dyo-guest-meta" id="dyoGuestMeta">
          <input type="text"     class="dyo-guest-finput" id="dyoGuestIName" placeholder="이름" maxlength="20" autocomplete="off">
          <input type="password" class="dyo-guest-finput" id="dyoGuestIPw"   placeholder="비밀번호" maxlength="40" autocomplete="off">
        </div>
        <div class="dyo-guest-compose">
          <textarea class="dyo-guest-textarea" id="dyoGuestTextarea" placeholder="방명록을 남겨보세요…" maxlength="500" rows="2"></textarea>
          <button class="dyo-guest-sendbtn" id="dyoGuestSend" title="전송 (Ctrl+Enter)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
          </button>
        </div>
      </div>
      <div class="dyo-brs-handle n"  data-dir="n"></div>
      <div class="dyo-brs-handle ne" data-dir="ne"></div>
      <div class="dyo-brs-handle e"  data-dir="e"></div>
      <div class="dyo-brs-handle se" data-dir="se"></div>
      <div class="dyo-brs-handle s"  data-dir="s"></div>
      <div class="dyo-brs-handle sw" data-dir="sw"></div>
      <div class="dyo-brs-handle w"  data-dir="w"></div>
      <div class="dyo-brs-handle nw" data-dir="nw"></div>
    </div>

    <!-- 관리자 빠른 메뉴바 -->
    <div class="dyo-admin-bar">
      <a href="/manage/newpost/?type=post&returnURL=%2Fmanage%2Fposts%2F" class="dyo-admin-btn" title="글쓰기">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
        </svg>
      </a>
      <a href="/manage" class="dyo-admin-btn" title="관리">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
      </a>
    </div>

  </s_t3>
  <script src="./images/script.js"></script>
  <script>
    // 타이핑 애니메이션
    (function() {
      var el = document.getElementById('typingText');
      if (!el) return;

      var text = 'Do You Coding?';
      var i = 0;
      var deleting = false;
      var typeSpeed = 120;
      var deleteSpeed = 80;
      var pauseAfterType = 2000;
      var pauseAfterDelete = 800;

      function tick() {
        if (!deleting) {
          el.textContent = text.substring(0, i + 1);
          i++;
          if (i === text.length) {
            deleting = true;
            setTimeout(tick, pauseAfterType);
          } else {
            setTimeout(tick, typeSpeed);
          }
        } else {
          i--;
          el.textContent = text.substring(0, i);
          if (i === 0) {
            deleting = false;
            setTimeout(tick, pauseAfterDelete);
          } else {
            setTimeout(tick, deleteSpeed);
          }
        }
      }

      setTimeout(tick, 1000);
    })();

    // 홈(인덱스) 페이지 - 데스크탑 홈화면 표시
    (function() {
      if (document.body.id !== 'tt-body-index') return;

      var desktop = document.getElementById('dyoDesktop');
      if (!desktop) return;

      // 데스크탑 표시 + 바디 스크롤 잠금
      desktop.classList.add('show');
      document.body.style.overflow = 'hidden';

      // 시계 업데이트
      function updateClock() {
        var now = new Date();
        var hh = String(now.getHours()).padStart(2, '0');
        var mm = String(now.getMinutes()).padStart(2, '0');
        var yyyy = now.getFullYear();
        var mo = String(now.getMonth() + 1).padStart(2, '0');
        var dd = String(now.getDate()).padStart(2, '0');
        var clockEl = document.getElementById('desktopClock');
        var dateEl  = document.getElementById('desktopDate');
        if (clockEl) clockEl.textContent = hh + ':' + mm;
        if (dateEl)  dateEl.textContent  = yyyy + '/' + mo + '/' + dd;
      }
      updateClock();
      setInterval(updateClock, 1000);

      // README 아이콘 클릭
      var iconReadme = document.getElementById('desktopIconReadme');
      if (iconReadme) {
        iconReadme.addEventListener('click', function() {
          if (window.dyoOpenReadme) window.dyoOpenReadme();
        });
      }

      // Terminal 아이콘 클릭 → 터미널 창 열기
      var iconShell = document.getElementById('desktopIconShell');
      if (iconShell) {
        iconShell.addEventListener('click', function() {
          if (window.dyoOpenShell) window.dyoOpenShell();
        });
      }

      // Blog 아이콘 클릭 → 전체글보기 창으로 열기
      var iconBlog = document.getElementById('desktopIconBlog');
      if (iconBlog) {
        iconBlog.addEventListener('click', function() {
          if (window.dyoOpenBrowser) window.dyoOpenBrowser('/category');
        });
      }

      // Guestbook 아이콘 클릭 → 채팅창 열기
      var iconGuest = document.getElementById('desktopIconGuest');
      if (iconGuest) {
        iconGuest.addEventListener('click', function() {
          if (window.dyoOpenGuest) window.dyoOpenGuest();
        });
      }

      // GitHub 아이콘 클릭 → 새 탭으로 열기
      var iconGithub = document.getElementById('desktopIconGithub');
      if (iconGithub) {
        iconGithub.addEventListener('click', function() {
          window.open('https://github.com/doyoungkim-code', '_blank');
        });
      }


    })();

    // 게시글 목차(TOC) 자동 생성
    (function() {
      var view = document.getElementById('article-view');
      if (!view) return;
      var bodyId = document.body.id;
      if (bodyId !== 'tt-body-page') return;

      var headings = view.querySelectorAll('h2, h3');
      if (headings.length < 2) return;

      var toc = document.createElement('div');
      toc.className = 'toc-wrapper';

      var title = document.createElement('div');
      title.className = 'toc-title';
      title.innerHTML = 'Table of Contents <span class="toc-toggle">&#9660;</span>';
      title.addEventListener('click', function() {
        toc.classList.toggle('collapsed');
      });

      var list = document.createElement('ul');
      list.className = 'toc-list';

      headings.forEach(function(h, i) {
        var id = 'toc-heading-' + i;
        h.id = id;
        var li = document.createElement('li');
        li.className = 'toc-' + h.tagName.toLowerCase();
        var a = document.createElement('a');
        a.href = '#' + id;
        a.textContent = h.textContent;
        li.appendChild(a);
        list.appendChild(li);
      });

      toc.appendChild(title);
      toc.appendChild(list);
      view.insertBefore(toc, view.firstChild);
    })();

    // 코드블럭: highlight.js 적용 + 언어 감지 + 복사 버튼 + wrapper
    (function() {
      var view = document.getElementById('article-view');
      if (!view) return;

      // highlight.js 실행 (Tistory data-ke-language 지원)
      if (typeof hljs !== 'undefined') {
        view.querySelectorAll('pre code').forEach(function(codeEl) {
          var pre = codeEl.parentElement;
          var keLang = pre && pre.getAttribute('data-ke-language');
          if (keLang && !codeEl.classList.contains('hljs')) {
            codeEl.className = 'language-' + keLang.toLowerCase();
          }
          if (!codeEl.classList.contains('hljs')) {
            hljs.highlightElement(codeEl);
          }
        });
        // code 없이 pre만 있는 경우
        view.querySelectorAll('pre').forEach(function(pre) {
          if (!pre.querySelector('code')) {
            var code = document.createElement('code');
            code.textContent = pre.textContent;
            var keLang = pre.getAttribute('data-ke-language');
            if (keLang) code.className = 'language-' + keLang.toLowerCase();
            pre.textContent = '';
            pre.appendChild(code);
            hljs.highlightElement(code);
          }
        });
      }

      // 언어 감지 맵: class명 → 표시 이름
      var langMap = {
        'java': 'Java', 'python': 'Python', 'py': 'Python',
        'javascript': 'JavaScript', 'js': 'JavaScript',
        'typescript': 'TypeScript', 'ts': 'TypeScript',
        'html': 'HTML', 'css': 'CSS', 'scss': 'SCSS',
        'json': 'JSON', 'xml': 'XML', 'yaml': 'YAML', 'yml': 'YAML',
        'sql': 'SQL', 'bash': 'Bash', 'sh': 'Shell', 'shell': 'Shell',
        'c': 'C', 'cpp': 'C++', 'csharp': 'C#', 'cs': 'C#',
        'go': 'Go', 'rust': 'Rust', 'ruby': 'Ruby', 'rb': 'Ruby',
        'php': 'PHP', 'swift': 'Swift', 'kotlin': 'Kotlin', 'kt': 'Kotlin',
        'dart': 'Dart', 'scala': 'Scala', 'r': 'R',
        'markdown': 'Markdown', 'md': 'Markdown',
        'dockerfile': 'Dockerfile', 'docker': 'Docker',
        'groovy': 'Groovy', 'gradle': 'Gradle',
        'properties': 'Properties', 'ini': 'INI', 'toml': 'TOML',
        'plaintext': 'Text', 'text': 'Text'
      };

      // 언어 색상 맵
      var langColors = {
        'Java': '#b07219', 'Python': '#3572A5', 'JavaScript': '#f1e05a',
        'TypeScript': '#3178c6', 'HTML': '#e34c26', 'CSS': '#563d7c',
        'JSON': '#292929', 'SQL': '#e38c00', 'Bash': '#89e051',
        'Shell': '#89e051', 'C': '#555555', 'C++': '#f34b7d',
        'C#': '#178600', 'Go': '#00ADD8', 'Rust': '#dea584',
        'Ruby': '#701516', 'PHP': '#4F5D95', 'Swift': '#F05138',
        'Kotlin': '#A97BFF', 'Dart': '#00B4AB', 'Scala': '#c22d40',
        'Dockerfile': '#384d54', 'Groovy': '#4298b8', 'Gradle': '#02303A',
        'SCSS': '#c6538c', 'XML': '#0060ac', 'YAML': '#cb171e',
        'Markdown': '#083fa1'
      };

      // 코드 내용으로 언어 추측
      function guessLang(code) {
        if (/public\s+(static\s+)?void\s+main|System\.out\.print|import\s+java\.|@(Override|Autowired|Service|Controller|Repository|Entity|Component)/.test(code)) return 'Java';
        if (/from\s+\w+\s+import|def\s+\w+\s*\(|print\s*\(|if\s+__name__/.test(code)) return 'Python';
        if (/console\.\w+\(|=>\s*\{|const\s+\w+\s*=|let\s+\w+\s*=|require\s*\(|module\.exports/.test(code)) return 'JavaScript';
        if (/interface\s+\w+|:\s*(string|number|boolean)\b|<\w+>/.test(code) && /const\s+|let\s+|=>\s*/.test(code)) return 'TypeScript';
        if (/<\/?[a-z][\s\S]*>/i.test(code) && /<(div|span|html|head|body|p|a|img|ul|li|table|form)\b/i.test(code)) return 'HTML';
        if (/\{[\s\S]*?[\w-]+\s*:\s*[\w#][\s\S]*?\}/.test(code) && /(color|margin|padding|display|font-size|background)\s*:/.test(code)) return 'CSS';
        if (/^\s*(SELECT|INSERT|UPDATE|DELETE|CREATE|ALTER|DROP|FROM|WHERE)\b/im.test(code)) return 'SQL';
        if (/^(#!\/?bin\/|apt-get|sudo|echo|grep|chmod|mkdir|cd\s|ls\s|curl\s|wget\s)/m.test(code)) return 'Bash';
        if (/^\s*\{[\s\S]*"[\w]+":\s*/m.test(code)) return 'JSON';
        if (/^\s*<\?xml|<\/?\w+:\w+/m.test(code)) return 'XML';
        if (/^(FROM|RUN|CMD|EXPOSE|COPY|ADD|ENTRYPOINT|WORKDIR)\s/m.test(code)) return 'Dockerfile';
        if (/^(spring|server|logging)\.\w+\s*=/m.test(code)) return 'Properties';
        if (/func\s+\w+|package\s+main|fmt\.Print/.test(code)) return 'Go';
        if (/fn\s+\w+|let\s+mut\s|println!\(|use\s+std::/.test(code)) return 'Rust';
        return '';
      }

      var pres = view.querySelectorAll('pre');
      pres.forEach(function(pre) {
        if (pre.closest('.code-block-wrapper')) return;

        var codeEl = pre.querySelector('code');
        var lang = '';

        // 1. class에서 언어 감지
        if (codeEl) {
          var cls = (codeEl.className || '') + ' ' + (pre.className || '');
          var m = cls.match(/(?:language-|lang-|hljs\s+)(\w+)/);
          if (m && langMap[m[1].toLowerCase()]) {
            lang = langMap[m[1].toLowerCase()];
          }
        }
        // 2. data-ke-language (Tistory 에디터)
        if (!lang && pre.getAttribute('data-ke-language')) {
          var keLang = pre.getAttribute('data-ke-language').toLowerCase();
          if (langMap[keLang]) lang = langMap[keLang];
        }
        // 3. 코드 내용으로 추측
        if (!lang) {
          var codeText = (codeEl || pre).textContent || '';
          lang = guessLang(codeText);
        }

        var dotColor = (lang && langColors[lang]) ? langColors[lang] : '#8b949e';
        var displayLang = lang || 'Code';

        // wrapper 생성
        var wrapper = document.createElement('div');
        wrapper.className = 'code-block-wrapper';

        // header
        var header = document.createElement('div');
        header.className = 'code-block-header';
        header.innerHTML =
          '<span class="code-lang-label">' +
            '<span class="code-lang-dot" style="background:' + dotColor + ';"></span>' +
            displayLang +
          '</span>' +
          '<button type="button" class="code-copy-btn">' +
            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>' +
            '<span>Copy</span>' +
          '</button>';

        // 복사 기능
        var btn = header.querySelector('.code-copy-btn');
        btn.addEventListener('click', function() {
          var text = (codeEl || pre).textContent;
          navigator.clipboard.writeText(text).then(function() {
            btn.classList.add('copied');
            btn.querySelector('span').textContent = 'Copied!';
            btn.querySelector('svg').innerHTML = '<polyline points="20 6 9 17 4 12"></polyline>';
            setTimeout(function() {
              btn.classList.remove('copied');
              btn.querySelector('span').textContent = 'Copy';
              btn.querySelector('svg').innerHTML = '<rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>';
            }, 2000);
          });
        });

        pre.parentNode.insertBefore(wrapper, pre);
        wrapper.appendChild(header);
        wrapper.appendChild(pre);
      });
    })();

    // 스크롤 진행바 + 맨 위로 가기 버튼
    (function() {
      var progressBar = document.getElementById('scrollProgress');
      var btnTop = document.getElementById('btnScrollTop');
      if (!progressBar || !btnTop) return;

      // 게시글 페이지에서만 진행바 표시
      var isArticle = document.body.id === 'tt-body-page';

      window.addEventListener('scroll', function() {
        var scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        var docHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;

        // 진행바
        if (isArticle && docHeight > 0) {
          var progress = (scrollTop / docHeight) * 100;
          progressBar.style.width = progress + '%';
        }

        // 맨 위로 버튼: 300px 이상 스크롤 시 표시
        if (scrollTop > 300) {
          btnTop.classList.add('visible');
        } else {
          btnTop.classList.remove('visible');
        }
      });

      btnTop.addEventListener('click', function() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    })();

    // ============================================================
    // 가상 터미널 창 (드래그 가능, 최소화/최대화)
    // ============================================================
    (function() {
      var win      = document.getElementById('dyoShellWin');
      var btnShell = document.getElementById('btnShell');
      var titlebar = document.getElementById('dyoShellTitlebar');
      var closeBtn = document.getElementById('dyoShellClose');
      var minBtn   = document.getElementById('dyoShellMin');
      var maxBtn   = document.getElementById('dyoShellMax');
      var termInput= document.getElementById('termInput');
      var output   = document.getElementById('termOutput');
      var form     = document.getElementById('dyoTermForm');
      if (!win || !btnShell) return;

      var history = [], histIdx = -1;
      var dragging = false, dragOX = 0, dragOY = 0;
      var resizing = false, resizeDir = '', resizeSX = 0, resizeSY = 0, resizeSRect = null;
      var MIN_W = 360, MIN_H = 180;
      // 최대화 전 저장용
      var savedPos = null;

      var categories = {
        'project':          { label: '📂 Project',           url: '/category/Project' },
        'dev log':          { label: '📁 Dev Log',            url: '/category/Project/Dev%20Log' },
        'retrospect':       { label: '📁 Retrospect',         url: '/category/Project/Retrospect' },
        'backend':          { label: '☕ Backend',             url: '/category/Backend' },
        'java':             { label: '☕ Java',                url: '/category/Backend/Java' },
        'spring':           { label: '🍃 Spring Boot',        url: '/category/Backend/Spring%20Boot' },
        'spring boot':      { label: '🍃 Spring Boot',        url: '/category/Backend/Spring%20Boot' },
        'database':         { label: '💾 Database',            url: '/category/Backend/Database' },
        'db':               { label: '💾 Database',            url: '/category/Backend/Database' },
        'frontend':         { label: '🎨 Frontend',           url: '/category/Frontend' },
        'mobile':           { label: '📱 Mobile',             url: '/category/Frontend/Mobile' },
        'web':              { label: '🌐 Web',                url: '/category/Frontend/Web' },
        'cs':               { label: '💻 CS & Engineering',   url: '/category/CS%20&%20Engineering' },
        'c':                { label: '📗 C',                  url: '/category/CS%20&%20Engineering/C' },
        'algorithm':        { label: '📐 Algorithm',           url: '/category/CS%20&%20Engineering/Algorithm' },
        'computer science': { label: '📚 Computer Science',   url: '/category/CS%20&%20Engineering/Computer%20Science' },
        'infra':            { label: '🧱 Infra & Tools',      url: '/category/CS%20&%20Engineering/Infra%20&%20Tools' },
        'growth':           { label: '🌱 Growth',             url: '/category/Growth' },
        'certifications':   { label: '📜 Certifications',     url: '/category/Growth/Certifications' },
        'english':          { label: '📖 English',            url: '/category/Growth/English' },
        'books':            { label: '📚 Books',              url: '/category/Growth/Books' },
        'documents':        { label: '📑 Documents',          url: '/category/Growth/Documents' },
        'etc':              { label: '📄 etc',                url: '/category/Growth/etc' }
      };

      function esc(t) { return t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

      function addOutput(cmd, html) {
        var block = document.createElement('div');
        block.className = 'dyo-output-block';
        block.innerHTML =
          '<div class="dyo-output-cmd-line">' +
            '<span class="dyo-output-prompt">[doyoucode@guest ~]$</span> ' +
            '<span class="dyo-output-cmd">' + esc(cmd) + '</span>' +
          '</div>' +
          '<div class="dyo-output-result">' + html + '</div>';
        output.insertBefore(block, form);
        output.scrollTop = output.scrollHeight;
      }

      var BANNER = '╔════════════════════════════════════════╗\n║  Welcome to doyoucode\'s terminal       ║\n║  Type \'<span class="tr-cmd">help</span>\' to see available commands ║\n╚════════════════════════════════════════╝';

      // ── 브라우저 창 열기 (iframe) ──
      function launchBrowser(url) {
        if (window.dyoOpenBrowser) window.dyoOpenBrowser(url);
      }

      function processCmd(raw) {
        var cmd = raw.trim();
        if (!cmd) return;
        history.push(cmd); histIdx = history.length;

        var parts = cmd.split(/\s+/);
        var base = parts[0].toLowerCase();
        var arg  = parts.slice(1).join(' ');

        switch (base) {
          case 'help':
            addOutput(cmd,
              '<span class="tr-info">Available commands:</span><br><br>' +
              '<span class="tr-cmd">help</span>               — show this message<br>' +
              '<span class="tr-cmd">about</span> / <span class="tr-cmd">whoami</span>  — about doyoucode<br>' +
              '<span class="tr-cmd">ls</span>                 — list categories<br>' +
              '<span class="tr-cmd">cd &lt;category&gt;</span>     — navigate to category<br>' +
              '<span class="tr-cmd">search &lt;keyword&gt;</span>  — search blog posts<br>' +
              '<span class="tr-cmd">date</span>               — current date & time<br>' +
              '<span class="tr-cmd">echo &lt;text&gt;</span>       — echo text<br>' +
              '<span class="tr-cmd">github</span>             — open GitHub profile<br>' +
              '<span class="tr-cmd">clear</span>              — clear terminal<br>' +
              '<span class="tr-cmd">exit</span>               — close terminal'
            ); break;

          case 'about': case 'whoami':
            addOutput(cmd,
              '<span class="tr-success"><b>doyoucode</b></span> — Backend Developer<br>' +
              '프로그래밍이 일상이 된 개발자 꿈나무의 기록 공간<br>' +
              '<span style="color:#5c6370">코딩 공부를 하며 마주친 시행착오와 해결 과정을 정리하며 성장 중</span>'
            ); break;

          case 'ls':
            var h = '<span class="tr-info">📂 Categories</span><br><br>';
            [{name:'Project',color:'#56b6c2',subs:['Dev Log','Retrospect']},
             {name:'Backend',color:'#c678dd',subs:['Java','Spring Boot','Database']},
             {name:'Frontend',color:'#61afef',subs:['Mobile','Web']},
             {name:'CS & Engineering',color:'#e06c75',subs:['C','Algorithm','Computer Science','Infra & Tools']},
             {name:'Growth',color:'#98c379',subs:['Certifications','English','Books','Documents','etc']}
            ].forEach(function(c) {
              h += '<b style="color:'+c.color+'">📂 '+c.name+'</b> <span style="color:#5c6370">('+c.subs.join(', ')+')</span><br>';
            });
            h += '<br><span style="color:#5c6370">💡 <span class="tr-cmd">cd &lt;name&gt;</span> to navigate</span>';
            addOutput(cmd, h); break;

          case 'cd':
            if (!arg) { addOutput(cmd,'<span class="tr-warn">Usage: cd &lt;category name&gt;</span>'); break; }
            var key = arg.toLowerCase();
            if (categories[key]) {
              addOutput(cmd,'<span class="tr-success">📂 Opening '+categories[key].label+' ...</span>');
              launchBrowser(categories[key].url);
            } else {
              var sugg = Object.keys(categories).filter(function(k){ return k.indexOf(key)!==-1; })
                .slice(0,3).map(function(k){ return categories[k].label; });
              var msg = '<span class="tr-error">bash: cd: '+esc(arg)+': No such directory</span>';
              if (sugg.length) msg += '<br><span class="tr-warn">Did you mean: '+sugg.join(', ')+'?</span>';
              addOutput(cmd, msg);
            } break;

          case 'search': case 'grep':
            if (!arg) { addOutput(cmd,'<span class="tr-warn">Usage: search &lt;keyword&gt;</span>'); break; }
            addOutput(cmd,'<span class="tr-success">🔍 Searching for "'+esc(arg)+'" ...</span>');
            launchBrowser('/search/'+encodeURIComponent(arg)); break;

          case 'date':
            var now = new Date();
            var ds = now.getFullYear()+'-'+String(now.getMonth()+1).padStart(2,'0')+'-'+
              String(now.getDate()).padStart(2,'0')+' '+String(now.getHours()).padStart(2,'0')+':'+
              String(now.getMinutes()).padStart(2,'0')+':'+String(now.getSeconds()).padStart(2,'0');
            addOutput(cmd,'<span class="tr-default">'+['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][now.getDay()]+' '+ds+' KST</span>'); break;

          case 'echo':
            addOutput(cmd,'<span class="tr-default">'+(arg?esc(arg):'')+'</span>'); break;

          case 'clear':
            while (output.firstChild && output.firstChild !== form) {
              output.removeChild(output.firstChild);
            }
            var bannerEl = document.createElement('div');
            bannerEl.className = 'dyo-term-banner';
            bannerEl.innerHTML = BANNER;
            output.insertBefore(bannerEl, form);
            output.scrollTop = 0;
            return;

          case 'github':
            addOutput(cmd,'<span class="tr-success">🚀 Opening GitHub ...</span>');
            setTimeout(function(){ window.open('https://github.com/doyoungkim-code','_blank'); }, 500); break;

          case 'sudo':   addOutput(cmd,'<span class="tr-error">🔒 Permission denied 😎</span>'); break;
          case 'rm':     addOutput(cmd,'<span class="tr-error">🚫 Not gonna happen here 😅</span>'); break;
          case 'exit':   closeWindow(); return;
          case 'hello': case 'hi':
            addOutput(cmd,'<span class="tr-success">👋 Hello! Type <span class="tr-cmd">help</span> to see what you can do.</span>'); break;

          default:
            addOutput(cmd,
              '<span class="tr-error">bash: '+esc(base)+': command not found</span><br>' +
              '<span style="color:#5c6370">Type <span class="tr-cmd">help</span> to see available commands.</span>'
            );
        }
      }

      // ── 창 열기/닫기/최소화/최대화 ──
      function openWindow() {
        if (!win.classList.contains('open')) {
          var W = 680, H = 440;
          win.style.left   = Math.round((window.innerWidth  - W) / 2) + 'px';
          win.style.top    = Math.round((window.innerHeight - H) / 2) + 'px';
          win.style.right  = 'auto';
          win.style.bottom = 'auto';
        }
        win.classList.add('open');
        win.classList.remove('minimized');
        btnShell.classList.add('active');
        window._dyoZTop = (window._dyoZTop || 9000) + 1;
        win.style.zIndex = window._dyoZTop;
        setTimeout(function() {
          termInput && termInput.focus();
          output.scrollTop = output.scrollHeight;
        }, 50);
      }
      function closeWindow() {
        win.classList.remove('open', 'minimized', 'maximized');
        btnShell.classList.remove('active');
        savedPos = null;
      }
      function minimizeWindow() {
        if (win.classList.contains('minimized')) {
          win.classList.remove('minimized');
          setTimeout(function(){ termInput && termInput.focus(); }, 50);
        } else {
          // 최대화 상태라면 먼저 복원
          if (win.classList.contains('maximized')) {
            win.classList.remove('maximized');
            if (savedPos) {
              win.style.left = savedPos.left; win.style.top = savedPos.top;
              win.style.right = savedPos.right; win.style.bottom = savedPos.bottom;
              win.style.width = savedPos.width; win.style.height = savedPos.height;
              savedPos = null;
            }
          }
          win.classList.add('minimized');
        }
      }
      function maximizeWindow() {
        if (win.classList.contains('maximized')) {
          // 복원
          win.classList.remove('maximized');
          if (savedPos) {
            win.style.left   = savedPos.left;
            win.style.top    = savedPos.top;
            win.style.right  = savedPos.right;
            win.style.bottom = savedPos.bottom;
            win.style.width  = savedPos.width;
            win.style.height = savedPos.height;
            savedPos = null;
          }
        } else {
          // 현재 위치 저장
          savedPos = {
            left: win.style.left, top: win.style.top,
            right: win.style.right, bottom: win.style.bottom,
            width: win.style.width, height: win.style.height
          };
          win.classList.add('maximized');
          // 최대화 시 인라인 스타일 초기화 (CSS로 제어)
          win.style.left = win.style.top = win.style.right =
          win.style.bottom = win.style.width = win.style.height = '';
        }
        setTimeout(function(){ termInput && termInput.focus(); }, 50);
      }

      // 데스크탑 아이콘에서 호출할 수 있도록 전역 노출
      window.dyoOpenShell = openWindow;

      // 창 포커스 (z-index 최상위)
      function bringToFront() {
        window._dyoZTop = (window._dyoZTop || 9000) + 1;
        win.style.zIndex = window._dyoZTop;
      }
      win.addEventListener('mousedown', bringToFront);

      btnShell.addEventListener('click', function() {
        win.classList.contains('open') ? closeWindow() : openWindow();
      });
      if (closeBtn) closeBtn.addEventListener('click', closeWindow);
      if (minBtn)   minBtn.addEventListener('click',   minimizeWindow);
      if (maxBtn)   maxBtn.addEventListener('click',   maximizeWindow);

      // ESC 닫기
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && win.classList.contains('open')) closeWindow();
      });

      // ── 드래그 ──
      titlebar.addEventListener('dblclick', function(e) {
        if (e.target === closeBtn || e.target === minBtn || e.target === maxBtn) return;
        maximizeWindow();
      });

      titlebar.addEventListener('mousedown', function(e) {
        if (win.classList.contains('maximized')) return;
        if (e.target === minBtn || e.target === maxBtn || e.target === closeBtn) return;
        var rect = win.getBoundingClientRect();
        // 인라인 left/top 좌표로 전환
        win.style.left   = rect.left + 'px';
        win.style.top    = rect.top  + 'px';
        win.style.right  = 'auto';
        win.style.bottom = 'auto';
        dragging = true;
        dragOX = e.clientX - rect.left;
        dragOY = e.clientY - rect.top;
        e.preventDefault();
      });

      document.addEventListener('mousemove', function(e) {
        if (dragging) {
          var x = Math.max(0, Math.min(window.innerWidth  - win.offsetWidth,  e.clientX - dragOX));
          var y = Math.max(0, Math.min(window.innerHeight - 40, e.clientY - dragOY));
          win.style.left = x + 'px';
          win.style.top  = y + 'px';
        }
        if (resizing) {
          var dx = e.clientX - resizeSX;
          var dy = e.clientY - resizeSY;
          var r = resizeSRect;
          var newL = r.left, newT = r.top, newW = r.width, newH = r.height;
          if (resizeDir.indexOf('e') !== -1) newW = Math.max(MIN_W, r.width + dx);
          if (resizeDir.indexOf('s') !== -1) newH = Math.max(MIN_H, r.height + dy);
          if (resizeDir.indexOf('w') !== -1) { newW = Math.max(MIN_W, r.width - dx); newL = r.left + r.width - newW; }
          if (resizeDir.indexOf('n') !== -1) { newH = Math.max(MIN_H, r.height - dy); newT = r.top + r.height - newH; }
          win.style.left   = newL + 'px';
          win.style.top    = newT + 'px';
          win.style.width  = newW + 'px';
          win.style.height = newH + 'px';
        }
      });

      document.addEventListener('mouseup', function() {
        dragging = false;
        resizing = false;
      });

      // ── 리사이즈 핸들 ──
      win.querySelectorAll('.dyo-brs-handle').forEach(function(handle) {
        handle.addEventListener('mousedown', function(e) {
          if (win.classList.contains('maximized') || win.classList.contains('minimized')) return;
          e.stopPropagation();
          e.preventDefault();
          resizing = true;
          resizeDir = handle.getAttribute('data-dir');
          resizeSX = e.clientX;
          resizeSY = e.clientY;
          var rect = win.getBoundingClientRect();
          resizeSRect = { left: rect.left, top: rect.top, width: rect.width, height: rect.height };
          win.style.left   = rect.left   + 'px';
          win.style.top    = rect.top    + 'px';
          win.style.width  = rect.width  + 'px';
          win.style.height = rect.height + 'px';
          win.style.right  = 'auto';
          win.style.bottom = 'auto';
        });
      });

      // 터치 드래그 (모바일)
      titlebar.addEventListener('touchstart', function(e) {
        if (win.classList.contains('maximized')) return;
        var t = e.touches[0];
        var rect = win.getBoundingClientRect();
        win.style.left   = rect.left + 'px';
        win.style.top    = rect.top  + 'px';
        win.style.right  = 'auto';
        win.style.bottom = 'auto';
        dragging = true;
        dragOX = t.clientX - rect.left;
        dragOY = t.clientY - rect.top;
      }, { passive: true });

      document.addEventListener('touchmove', function(e) {
        if (!dragging) return;
        var t = e.touches[0];
        var x = Math.max(0, Math.min(window.innerWidth  - win.offsetWidth,  t.clientX - dragOX));
        var y = Math.max(0, Math.min(window.innerHeight - 40, t.clientY - dragOY));
        win.style.left = x + 'px';
        win.style.top  = y + 'px';
      }, { passive: true });

      document.addEventListener('touchend', function() { dragging = false; });

      // ── 입력 이벤트 ──
      // Enter: form submit (가장 안정적인 크로스-브라우저 방식)
      if (form) {
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          if (!termInput) return;
          processCmd(termInput.value);
          termInput.value = '';
          termInput.focus();
        });
      }

      // 화살표키(히스토리) + Tab(자동완성)만 keydown으로 처리
      if (termInput) {
        termInput.addEventListener('keydown', function(e) {
          if (e.key === 'ArrowUp' || e.keyCode === 38) {
            e.preventDefault();
            if (histIdx > 0) termInput.value = history[--histIdx];
          } else if (e.key === 'ArrowDown' || e.keyCode === 40) {
            e.preventDefault();
            termInput.value = histIdx < history.length-1 ? history[++histIdx] : (histIdx=history.length,'');
          } else if (e.key === 'Tab' || e.keyCode === 9) {
            e.preventDefault();
            var val = termInput.value.trim().toLowerCase();
            var cmds = ['help','about','whoami','ls','cd','search','grep','date','echo','clear','github','exit'];
            if (!val.includes(' ')) {
              var m = cmds.filter(function(c){ return c.startsWith(val); });
              if (m.length === 1) termInput.value = m[0];
            } else if (val.startsWith('cd ')) {
              var p = val.slice(3);
              var cm = Object.keys(categories).filter(function(k){ return k.startsWith(p); });
              if (cm.length === 1) termInput.value = 'cd ' + cm[0];
            }
          }
        });
      }

      if (output) {
        output.addEventListener('click', function(e) {
          if (e.target.tagName !== 'A') termInput && termInput.focus();
        });
      }
    })();

    // ============================================================
    // 가상 브라우저 창 (드래그 가능, 최소화/최대화/닫기)
    // ============================================================
    (function() {
      var bwin     = document.getElementById('dyoBrowserWin');
      var btbar    = document.getElementById('dyoBrowserTitlebar');
      var bClose   = document.getElementById('dyoBrowserClose');
      var bMin     = document.getElementById('dyoBrowserMin');
      var bMax     = document.getElementById('dyoBrowserMax');
      var bBack    = document.getElementById('dyoBrowserBack');
      var bFwd     = document.getElementById('dyoBrowserFwd');
      var bReload  = document.getElementById('dyoBrowserReload');
      var bUrlBar  = document.getElementById('dyoBrowserUrl');
      var bFrame   = document.getElementById('dyoBrowserFrame');
      if (!bwin || !bFrame) return;
      window._dyoBWin = bwin;
      window._dyoBFrame = bFrame;
      window._dyoBUrlBar = bUrlBar;

      var dragging = false, dragOX = 0, dragOY = 0;
      var resizing = false, resizeDir = '', resizeSX = 0, resizeSY = 0, resizeSRect = null;
      var savedPos = null;
      var MIN_W = 360, MIN_H = 200;

      function openBrowser(url) {
        var fullUrl = url.startsWith('http') ? url : (window.location.origin + url);
        bFrame.src = fullUrl;
        bUrlBar.textContent = window.location.hostname + (url.startsWith('/') ? url : '/' + url);
        if (!bwin.classList.contains('open')) {
          var W = Math.min(1200, window.innerWidth  - 40);
          var H = Math.min(700,  window.innerHeight - 40);
          bwin.style.width  = W + 'px';
          bwin.style.height = H + 'px';
          bwin.style.left   = Math.round((window.innerWidth  - W) / 2) + 'px';
          bwin.style.top    = Math.round((window.innerHeight - H) / 2) + 'px';
          bwin.style.right  = 'auto';
          bwin.style.bottom = 'auto';
        }
        bwin.classList.add('open');
        bwin.classList.remove('minimized');
        window._dyoZTop = (window._dyoZTop || 9000) + 1;
        bwin.style.zIndex = window._dyoZTop;
      }

      function closeBrowser() {
        bwin.classList.remove('open', 'minimized', 'maximized');
        bFrame.src = 'about:blank';
        bUrlBar.textContent = 'about:blank';
        savedPos = null;
      }

      function minimizeBrowser() {
        bwin.classList.toggle('minimized');
      }

      function maximizeBrowser() {
        if (bwin.classList.contains('maximized')) {
          bwin.classList.remove('maximized');
          if (savedPos) {
            bwin.style.left   = savedPos.left;
            bwin.style.top    = savedPos.top;
            bwin.style.right  = savedPos.right;
            bwin.style.bottom = savedPos.bottom;
            bwin.style.width  = savedPos.width;
            bwin.style.height = savedPos.height;
            savedPos = null;
          }
        } else {
          savedPos = {
            left: bwin.style.left, top: bwin.style.top,
            right: bwin.style.right, bottom: bwin.style.bottom,
            width: bwin.style.width, height: bwin.style.height
          };
          bwin.classList.add('maximized');
          bwin.style.left = bwin.style.top = bwin.style.right =
          bwin.style.bottom = bwin.style.width = bwin.style.height = '';
        }
      }

      // URL 업데이트 (iframe 내 페이지 이동 감지)
      bFrame.addEventListener('load', function() {
        try {
          var loc = bFrame.contentWindow.location.href;
          if (loc && loc !== 'about:blank' && loc !== 'about:srcdoc') {
            bUrlBar.textContent = loc.replace(/^https?:\/\//, '');
          }
        } catch(e) { /* cross-origin: 무시 */ }
      });

      // 전역 노출
      window.dyoOpenBrowser = openBrowser;

      // 창 포커스 (z-index 최상위)
      function bringToFront() {
        window._dyoZTop = (window._dyoZTop || 9000) + 1;
        bwin.style.zIndex = window._dyoZTop;
      }
      bwin.addEventListener('mousedown', bringToFront);

      if (bClose)  bClose.addEventListener('click',  closeBrowser);
      if (bMin)    bMin.addEventListener('click',    minimizeBrowser);
      if (bMax)    bMax.addEventListener('click',    maximizeBrowser);
      if (bBack)   bBack.addEventListener('click',   function() { try { bFrame.contentWindow.history.back(); } catch(e){} });
      if (bFwd)    bFwd.addEventListener('click',    function() { try { bFrame.contentWindow.history.forward(); } catch(e){} });
      if (bReload) bReload.addEventListener('click', function() { try { bFrame.contentWindow.location.reload(); } catch(e){ bFrame.src = bFrame.src; } });

      // 더블클릭 타이틀바 → 최대화 토글
      btbar.addEventListener('dblclick', function(e) {
        if (e.target === bClose || e.target === bMin || e.target === bMax) return;
        maximizeBrowser();
      });

      // 드래그 (마우스)
      btbar.addEventListener('mousedown', function(e) {
        if (bwin.classList.contains('maximized')) return;
        if (e.target === bClose || e.target === bMin || e.target === bMax) return;
        var rect = bwin.getBoundingClientRect();
        bwin.style.left   = rect.left + 'px';
        bwin.style.top    = rect.top  + 'px';
        bwin.style.right  = 'auto';
        bwin.style.bottom = 'auto';
        dragging = true;
        dragOX = e.clientX - rect.left;
        dragOY = e.clientY - rect.top;
        bFrame.style.pointerEvents = 'none';
        e.preventDefault();
      });

      document.addEventListener('mousemove', function(e) {
        if (dragging) {
          var x = Math.max(0, Math.min(window.innerWidth  - bwin.offsetWidth,  e.clientX - dragOX));
          var y = Math.max(0, Math.min(window.innerHeight - 40, e.clientY - dragOY));
          bwin.style.left = x + 'px';
          bwin.style.top  = y + 'px';
        }
        if (resizing) {
          var dx = e.clientX - resizeSX;
          var dy = e.clientY - resizeSY;
          var r = resizeSRect;
          var newL = r.left, newT = r.top, newW = r.width, newH = r.height;
          if (resizeDir.indexOf('e') !== -1) newW = Math.max(MIN_W, r.width + dx);
          if (resizeDir.indexOf('s') !== -1) newH = Math.max(MIN_H, r.height + dy);
          if (resizeDir.indexOf('w') !== -1) { newW = Math.max(MIN_W, r.width - dx); newL = r.left + r.width - newW; }
          if (resizeDir.indexOf('n') !== -1) { newH = Math.max(MIN_H, r.height - dy); newT = r.top + r.height - newH; }
          bwin.style.left   = newL + 'px';
          bwin.style.top    = newT + 'px';
          bwin.style.width  = newW + 'px';
          bwin.style.height = newH + 'px';
        }
      });

      document.addEventListener('mouseup', function() {
        if (dragging || resizing) bFrame.style.pointerEvents = '';
        dragging = false;
        resizing = false;
      });

      // 리사이즈 핸들 (마우스)
      bwin.querySelectorAll('.dyo-brs-handle').forEach(function(handle) {
        handle.addEventListener('mousedown', function(e) {
          if (bwin.classList.contains('maximized') || bwin.classList.contains('minimized')) return;
          e.stopPropagation();
          e.preventDefault();
          resizing = true;
          resizeDir = handle.getAttribute('data-dir');
          resizeSX = e.clientX;
          resizeSY = e.clientY;
          var rect = bwin.getBoundingClientRect();
          resizeSRect = { left: rect.left, top: rect.top, width: rect.width, height: rect.height };
          bwin.style.left   = rect.left   + 'px';
          bwin.style.top    = rect.top    + 'px';
          bwin.style.width  = rect.width  + 'px';
          bwin.style.height = rect.height + 'px';
          bwin.style.right  = 'auto';
          bwin.style.bottom = 'auto';
          bFrame.style.pointerEvents = 'none';
        });
      });

      // 드래그 (터치)
      btbar.addEventListener('touchstart', function(e) {
        if (bwin.classList.contains('maximized')) return;
        var t = e.touches[0];
        var rect = bwin.getBoundingClientRect();
        bwin.style.left   = rect.left + 'px';
        bwin.style.top    = rect.top  + 'px';
        bwin.style.right  = 'auto';
        bwin.style.bottom = 'auto';
        dragging = true;
        dragOX = t.clientX - rect.left;
        dragOY = t.clientY - rect.top;
      }, { passive: true });

      document.addEventListener('touchmove', function(e) {
        if (!dragging) return;
        var t = e.touches[0];
        var x = Math.max(0, Math.min(window.innerWidth  - bwin.offsetWidth,  t.clientX - dragOX));
        var y = Math.max(0, Math.min(window.innerHeight - 40, t.clientY - dragOY));
        bwin.style.left = x + 'px';
        bwin.style.top  = y + 'px';
      }, { passive: true });

      document.addEventListener('touchend', function() { dragging = false; });
    })();
  </script>

  <script>
    (function() {
      var w        = document.getElementById('dyoReadmeWin');
      var titlebar = document.getElementById('dyoReadmeTitlebar');
      var closeBtn = document.getElementById('dyoReadmeClose');
      var minBtn   = document.getElementById('dyoReadmeMin');
      var maxBtn   = document.getElementById('dyoReadmeMax');
      if (!w) return;

      var dragging = false, dragOX = 0, dragOY = 0;
      var resizing = false, resizeDir = '', resizeSX = 0, resizeSY = 0, resizeSRect = null;
      var MIN_W = 360, MIN_H = 180;
      var savedPos = null;

      function openReadme() {
        if (!w.classList.contains('open')) {
          var W = Math.min(700, window.innerWidth  - 40);
          var H = Math.min(480, window.innerHeight - 40);
          w.style.width  = W + 'px';
          w.style.height = H + 'px';
          w.style.left   = Math.round((window.innerWidth  - W) / 2) + 'px';
          w.style.top    = Math.round((window.innerHeight - H) / 2) + 'px';
          w.style.right  = 'auto';
          w.style.bottom = 'auto';
        }
        w.classList.add('open');
        w.classList.remove('minimized');
        window._dyoZTop = (window._dyoZTop || 9000) + 1;
        w.style.zIndex = window._dyoZTop;
      }
      function closeReadme() {
        w.classList.remove('open', 'minimized', 'maximized');
        savedPos = null;
      }
      function minimizeReadme() {
        if (w.classList.contains('minimized')) {
          w.classList.remove('minimized');
        } else {
          if (w.classList.contains('maximized')) {
            w.classList.remove('maximized');
            if (savedPos) {
              w.style.left = savedPos.left; w.style.top = savedPos.top;
              w.style.right = savedPos.right; w.style.bottom = savedPos.bottom;
              w.style.width = savedPos.width; w.style.height = savedPos.height;
              savedPos = null;
            }
          }
          w.classList.add('minimized');
        }
      }
      function maximizeReadme() {
        if (w.classList.contains('maximized')) {
          w.classList.remove('maximized');
          if (savedPos) {
            w.style.left   = savedPos.left;
            w.style.top    = savedPos.top;
            w.style.right  = savedPos.right;
            w.style.bottom = savedPos.bottom;
            w.style.width  = savedPos.width;
            w.style.height = savedPos.height;
            savedPos = null;
          }
        } else {
          savedPos = {
            left: w.style.left, top: w.style.top,
            right: w.style.right, bottom: w.style.bottom,
            width: w.style.width, height: w.style.height
          };
          w.classList.add('maximized');
          w.style.left = w.style.top = w.style.right =
          w.style.bottom = w.style.width = w.style.height = '';
        }
      }

      window.dyoOpenReadme = openReadme;

      w.addEventListener('mousedown', function() {
        window._dyoZTop = (window._dyoZTop || 9000) + 1;
        w.style.zIndex = window._dyoZTop;
      });
      if (closeBtn) closeBtn.addEventListener('click', closeReadme);
      if (minBtn)   minBtn.addEventListener('click',   minimizeReadme);
      if (maxBtn)   maxBtn.addEventListener('click',   maximizeReadme);

      // 타이틀바 더블클릭 → 최대화 토글
      if (titlebar) {
        titlebar.addEventListener('dblclick', function(e) {
          if (e.target === closeBtn || e.target === minBtn || e.target === maxBtn) return;
          maximizeReadme();
        });

        // 드래그
        titlebar.addEventListener('mousedown', function(e) {
          if (w.classList.contains('maximized')) return;
          if (e.target === closeBtn || e.target === minBtn || e.target === maxBtn) return;
          var rect = w.getBoundingClientRect();
          w.style.left = rect.left + 'px'; w.style.top = rect.top + 'px';
          w.style.right = 'auto'; w.style.bottom = 'auto';
          dragging = true;
          dragOX = e.clientX - rect.left;
          dragOY = e.clientY - rect.top;
          e.preventDefault();
        });

        // 터치 드래그
        titlebar.addEventListener('touchstart', function(e) {
          if (w.classList.contains('maximized')) return;
          var t = e.touches[0];
          var rect = w.getBoundingClientRect();
          w.style.left = rect.left + 'px'; w.style.top = rect.top + 'px';
          w.style.right = 'auto'; w.style.bottom = 'auto';
          dragging = true;
          dragOX = t.clientX - rect.left;
          dragOY = t.clientY - rect.top;
        }, { passive: true });
      }

      document.addEventListener('mousemove', function(e) {
        if (dragging) {
          var x = Math.max(0, Math.min(window.innerWidth  - w.offsetWidth,  e.clientX - dragOX));
          var y = Math.max(0, Math.min(window.innerHeight - 40, e.clientY - dragOY));
          w.style.left = x + 'px'; w.style.top = y + 'px';
        }
        if (resizing) {
          var dx = e.clientX - resizeSX;
          var dy = e.clientY - resizeSY;
          var r = resizeSRect;
          var nL = r.left, nT = r.top, nW = r.width, nH = r.height;
          if (resizeDir.indexOf('e') !== -1) nW = Math.max(MIN_W, r.width + dx);
          if (resizeDir.indexOf('s') !== -1) nH = Math.max(MIN_H, r.height + dy);
          if (resizeDir.indexOf('w') !== -1) { nW = Math.max(MIN_W, r.width - dx); nL = r.left + r.width - nW; }
          if (resizeDir.indexOf('n') !== -1) { nH = Math.max(MIN_H, r.height - dy); nT = r.top + r.height - nH; }
          w.style.left = nL + 'px'; w.style.top = nT + 'px';
          w.style.width = nW + 'px'; w.style.height = nH + 'px';
        }
      });
      document.addEventListener('touchmove', function(e) {
        if (!dragging) return;
        var t = e.touches[0];
        var x = Math.max(0, Math.min(window.innerWidth  - w.offsetWidth,  t.clientX - dragOX));
        var y = Math.max(0, Math.min(window.innerHeight - 40, t.clientY - dragOY));
        w.style.left = x + 'px'; w.style.top = y + 'px';
      }, { passive: true });
      document.addEventListener('mouseup',  function() { dragging = false; resizing = false; });
      document.addEventListener('touchend', function() { dragging = false; });

      // 리사이즈 핸들
      w.querySelectorAll('.dyo-brs-handle').forEach(function(handle) {
        handle.addEventListener('mousedown', function(e) {
          if (w.classList.contains('maximized') || w.classList.contains('minimized')) return;
          e.stopPropagation(); e.preventDefault();
          resizing = true;
          resizeDir = handle.getAttribute('data-dir');
          resizeSX = e.clientX; resizeSY = e.clientY;
          var rect = w.getBoundingClientRect();
          resizeSRect = { left: rect.left, top: rect.top, width: rect.width, height: rect.height };
          w.style.left = rect.left + 'px'; w.style.top = rect.top + 'px';
          w.style.width = rect.width + 'px'; w.style.height = rect.height + 'px';
          w.style.right = 'auto'; w.style.bottom = 'auto';
        });
      });
    })();

    // ============================================================
    // Guestbook 채팅창
    // ============================================================
    (function() {
      var w        = document.getElementById('dyoGuestWin');
      var titlebar = document.getElementById('dyoGuestTitlebar');
      var closeBtn = document.getElementById('dyoGuestClose');
      var minBtn   = document.getElementById('dyoGuestMin');
      var maxBtn   = document.getElementById('dyoGuestMax');
      var reloadBtn  = document.getElementById('dyoGuestReload');
      var chat       = document.getElementById('dyoGuestChat');
      var loading    = document.getElementById('dyoGuestLoading');
      var metaRow    = document.getElementById('dyoGuestMeta');
      var nameInput  = document.getElementById('dyoGuestIName');
      var pwInput    = document.getElementById('dyoGuestIPw');
      var textarea   = document.getElementById('dyoGuestTextarea');
      var sendBtn    = document.getElementById('dyoGuestSend');
      if (!w) return;

      var ADMIN_NICK = 'doyoucode';
      var isOwner    = false;
      var isLoggedIn = false;
      var msgData    = {};   // id → { author, content }
      var dragging = false, dragOX = 0, dragOY = 0;
      var resizing = false, resizeDir = '', resizeSX = 0, resizeSY = 0, resizeSRect = null;
      var MIN_W = 300, MIN_H = 200;
      var savedPos = null;
      var loaded = false;

      // ── 유틸 ──
      function esc(t) {
        return String(t).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
      }

      function sha256hex(str) {
        return crypto.subtle.digest('SHA-256', new TextEncoder().encode(str))
          .then(function(buf) {
            return Array.from(new Uint8Array(buf))
              .map(function(b){ return b.toString(16).padStart(2,'0'); }).join('');
          });
      }

      // Tistory 방명록 비밀번호: SHA-256( MD5( encodeURIComponent(pw) ) )
      function tistoryHashPw(passwd) {
        var encoded = encodeURIComponent(passwd);
        var md5hash = (typeof md5 === 'function') ? md5(encoded) : encoded;
        return sha256hex(md5hash);
      }

      function sendGuest() {
        var text = textarea ? textarea.value.trim() : '';
        if (!text) return;
        var name = nameInput ? nameInput.value.trim() : '';
        var pw   = pwInput   ? pwInput.value        : '';
        if (!name && metaRow && !metaRow.classList.contains('owner-mode')) return;

        sendBtn.disabled = true;
        var hashPromise = pw ? tistoryHashPw(pw) : Promise.resolve('');
        hashPromise.then(function(hashedPw) {
          return fetch('/m/api/guestbook', {
            method: 'POST',
            credentials: 'include',
            headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
            body: JSON.stringify({
              captcha:    '',
              comment:    text,
              homepage:   '',
              isSecret:   false,
              mentionId:  null,
              name:       name,
              parent:     null,
              password:   hashedPw
            })
          });
        }).then(function(r) {
          if (!r.ok) throw new Error('HTTP ' + r.status);
          return r.json();
        }).then(function() {
          if (textarea) textarea.value = '';
          loaded = false;
          loadGuest();
        }).catch(function() {
          alert('전송에 실패했습니다. 다시 시도해주세요.');
        }).finally(function() {
          sendBtn.disabled = false;
        });
      }

      function editGuest(id, bwrap) {
        var d = msgData[id];
        if (!d) return;
        var bubbleEl = bwrap.querySelector('.dyo-chat-bubble');
        var editBtnEl = bwrap.querySelector('.dyo-chat-editbtn');
        bubbleEl.style.display = 'none';
        if (editBtnEl) editBtnEl.style.display = 'none';

        var form = document.createElement('div');
        form.className = 'dyo-cedit-wrap';
        form.innerHTML =
          '<textarea class="dyo-cedit-ta" rows="2">' + esc(d.content) + '</textarea>' +
          (isLoggedIn ? '' : '<input type="password" class="dyo-cedit-pw" placeholder="비밀번호">') +
          '<div class="dyo-cedit-btns">' +
          '<button class="dyo-cedit-cancel">취소</button>' +
          '<button class="dyo-cedit-save">수정</button>' +
          '</div>';
        bwrap.insertBefore(form, bubbleEl);

        var ta      = form.querySelector('.dyo-cedit-ta');
        var pwEl    = form.querySelector('.dyo-cedit-pw');
        var cancelB = form.querySelector('.dyo-cedit-cancel');
        var saveB   = form.querySelector('.dyo-cedit-save');

        ta.focus();
        ta.setSelectionRange(ta.value.length, ta.value.length);

        cancelB.addEventListener('click', function() {
          form.remove();
          bubbleEl.style.display = '';
          if (editBtnEl) editBtnEl.style.display = '';
        });

        function doSave() {
          var newText = ta.value.trim();
          if (!newText) return;
          var pwVal = pwEl ? pwEl.value : '';
          saveB.disabled = true;
          (pwVal ? tistoryHashPw(pwVal) : Promise.resolve(''))
            .then(function(hashed) {
              return fetch('/m/api/guestbook/' + id, {
                method: 'PUT',
                credentials: 'include',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ comment: newText, mentionId: null, name: d.author, password: hashed, secret: false })
              });
            })
            .then(function(r) { if (!r.ok) throw new Error(); return r.json(); })
            .then(function() { loaded = false; loadGuest(); })
            .catch(function() { alert('수정에 실패했습니다.'); saveB.disabled = false; });
        }

        saveB.addEventListener('click', doSave);
        ta.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) { e.preventDefault(); doSave(); }
        });
      }

      function deleteGuest(id, bwrap) {
        var d = msgData[id];
        if (!d) return;

        var bubbleEl  = bwrap.querySelector('.dyo-chat-bubble');
        var editBtnEl = bwrap.querySelector('.dyo-chat-editbtn');
        var delBtnEl  = bwrap.querySelector('.dyo-chat-delbtn');

        function restore() {
          bubbleEl.style.display = '';
          if (editBtnEl) editBtnEl.style.display = '';
          if (delBtnEl)  delBtnEl.style.display  = '';
        }

        function doDelete(hashedPw, form) {
          fetch('/m/api/guestbook/' + id, {
            method: 'DELETE',
            credentials: 'include',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ password: hashedPw })
          })
          .then(function(r) { if (!r.ok) throw new Error(); return r.json(); })
          .then(function() { loaded = false; loadGuest(); })
          .catch(function() {
            alert('삭제에 실패했습니다. 비밀번호를 확인해주세요.');
            if (form) form.remove();
            restore();
          });
        }

        if (isLoggedIn) {
          // 로그인 상태: 확인 다이얼로그만
          if (!confirm('이 메시지를 삭제하시겠습니까?')) return;
          doDelete('', null);
        } else {
          // 비로그인 게스트: 비밀번호 입력 폼 표시
          bubbleEl.style.display = 'none';
          if (editBtnEl) editBtnEl.style.display = 'none';
          if (delBtnEl)  delBtnEl.style.display  = 'none';

          var form = document.createElement('div');
          form.className = 'dyo-cedit-wrap';
          form.innerHTML =
            '<div class="dyo-cdel-notice">정말 삭제하시겠습니까?</div>' +
            '<input type="password" class="dyo-cedit-pw" placeholder="비밀번호">' +
            '<div class="dyo-cedit-btns">' +
            '<button class="dyo-cedit-cancel">취소</button>' +
            '<button class="dyo-cedit-save dyo-cedit-del">삭제</button>' +
            '</div>';
          bwrap.insertBefore(form, bubbleEl);

          var pwEl    = form.querySelector('.dyo-cedit-pw');
          var cancelB = form.querySelector('.dyo-cedit-cancel');
          var saveB   = form.querySelector('.dyo-cedit-save');

          pwEl.focus();

          cancelB.addEventListener('click', function() {
            form.remove();
            restore();
          });

          saveB.addEventListener('click', function() {
            var pwVal = pwEl.value;
            if (!pwVal) { pwEl.focus(); return; }
            saveB.disabled = true;
            tistoryHashPw(pwVal).then(function(hashed) {
              doDelete(hashed, form);
            });
          });

          pwEl.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') { e.preventDefault(); saveB.click(); }
          });
        }
      }

      function renderChat(msgs) {
        if (msgs.length === 0) {
          chat.innerHTML = '<div class="dyo-guest-empty">방명록이 비어있거나<br>불러올 수 없습니다.</div>';
        } else {
          chat.innerHTML = msgs.map(function(m) {
            var role    = m.isAdmin ? 'admin' : 'visitor';
            var editBtn = m.canEdit && m.id
              ? '<button class="dyo-chat-editbtn" data-id="' + m.id + '" title="수정">✏</button>'
              : '';
            var delBtn  = m.canDelete && m.id
              ? '<button class="dyo-chat-delbtn" data-id="' + m.id + '" title="삭제">🗑</button>'
              : '';
            return '<div class="dyo-chat-row ' + role + '">' +
                   '<div class="dyo-chat-wrap">' +
                   '<div class="dyo-chat-name">' + esc(m.author) + '</div>' +
                   '<div class="dyo-chat-bwrap">' +
                   '<div class="dyo-chat-bubble">' + esc(m.content) + '</div>' +
                   editBtn + delBtn +
                   '</div></div></div>';
          }).join('');
          chat.scrollTop = chat.scrollHeight;
        }
        loading.style.display = 'none';
        chat.style.display = 'flex';
      }

      function loadGuest() {
        loaded = true;
        loading.style.display = 'flex';
        loading.querySelector('span').textContent = '방명록 불러오는 중...';
        loading.querySelector('.dyo-guest-spinner').style.display = '';
        chat.style.display = 'none';
        chat.innerHTML = '';

        fetch('/m/api/guestbook?reverse=true', { credentials: 'include', cache: 'no-store' })
          .then(function(r) {
            if (!r.ok) throw new Error('HTTP ' + r.status);
            return r.json();
          })
          .then(function(json) {
            var items = (json.data && json.data.items) || [];
            var msgs = [];
            // Pass 1: 로그인 상태 확정
            //   isOwner    = 관리자 로그인 (isRequestUser && role=owner)
            //   isLoggedIn = 일반 계정 로그인 (isRequestUser, 관리자 포함)
            isOwner    = false;
            isLoggedIn = false;
            msgData    = {};
            items.forEach(function(item) {
              if (item.writer && item.writer.isRequestUser) {
                isLoggedIn = true;
                if (item.writer.role === 'owner') isOwner = true;
              }
              (item.children || []).forEach(function(c) {
                if (c.writer && c.writer.isRequestUser) {
                  isLoggedIn = true;
                  if (c.writer.role === 'owner') isOwner = true;
                }
              });
            });
            // Pass 2: canEdit 결정
            //   관리자(isOwner)    : 본인(관리자) 메시지만
            //   로그인 일반 계정   : isRequestUser=true인 본인 메시지만
            //   비로그인 게스트    : 게스트 메시지 전체 (클릭 시 비밀번호 입력)
            function calcCanEdit(writer) {
              var isAdmin = !!(writer && writer.role === 'owner');
              var isMine  = !!(writer && writer.isRequestUser);
              if (isOwner)    return isAdmin;   // 관리자: 관리자 메시지만
              if (isLoggedIn) return isMine;    // 로그인: 본인 메시지만
              return !isAdmin;                  // 비로그인: 게스트 메시지 전체
            }
            function calcCanDelete(writer) {
              var isAdmin = !!(writer && writer.role === 'owner');
              var isMine  = !!(writer && writer.isRequestUser);
              if (isOwner)    return true;      // 관리자: 모든 메시지 삭제 가능
              if (isLoggedIn) return isMine;    // 로그인: 본인 메시지만
              return !isAdmin;                  // 비로그인: 게스트 메시지 전체 (비밀번호 필요)
            }
            items.forEach(function(item) {
              var isAdmin    = !!(item.writer && item.writer.role === 'owner');
              var canEdit    = calcCanEdit(item.writer);
              var canDelete  = calcCanDelete(item.writer);
              msgData[item.id] = { author: item.writer ? item.writer.name : '방문자', content: item.content };
              msgs.push({ id: item.id, author: item.writer ? item.writer.name : '방문자', content: item.content, isAdmin: isAdmin, canEdit: canEdit, canDelete: canDelete });
              (item.children || []).forEach(function(child) {
                var childIsAdmin   = !!(child.writer && child.writer.role === 'owner');
                var childCanEdit   = calcCanEdit(child.writer);
                var childCanDelete = calcCanDelete(child.writer);
                msgData[child.id] = { author: child.writer ? child.writer.name : ADMIN_NICK, content: child.content };
                msgs.push({ id: child.id, author: child.writer ? child.writer.name : ADMIN_NICK, content: child.content, isAdmin: true, canEdit: childCanEdit, canDelete: childCanDelete });
              });
            });
            // owner이면 이름/비밀번호 입력 숨기기
            if (metaRow) {
              if (isOwner) metaRow.classList.add('owner-mode');
              else         metaRow.classList.remove('owner-mode');
            }
            renderChat(msgs);
          })
          .catch(function() {
            loading.querySelector('span').textContent = '불러오기 실패. ↺ 버튼으로 재시도';
            loading.querySelector('.dyo-guest-spinner').style.display = 'none';
          });
      }

      // ── 창 열기/닫기/최소화/최대화 ──
      function openGuest() {
        if (!w.classList.contains('open')) {
          var W = Math.min(360, window.innerWidth  - 40);
          var H = Math.min(580, window.innerHeight - 40);
          w.style.width  = W + 'px';
          w.style.height = H + 'px';
          w.style.left   = Math.round(window.innerWidth - W - 24) + 'px';
          w.style.top    = Math.round((window.innerHeight - H) / 2) + 'px';
          w.style.right  = 'auto';
          w.style.bottom = 'auto';
        }
        w.classList.add('open');
        w.classList.remove('minimized');
        window._dyoZTop = (window._dyoZTop || 9000) + 1;
        w.style.zIndex = window._dyoZTop;
        if (!loaded) loadGuest();
      }
      function closeGuest() {
        w.classList.remove('open','minimized','maximized');
        savedPos = null;
      }
      function minimizeGuest() {
        if (w.classList.contains('minimized')) {
          w.classList.remove('minimized');
        } else {
          if (w.classList.contains('maximized')) {
            w.classList.remove('maximized');
            if (savedPos) {
              w.style.left=savedPos.left; w.style.top=savedPos.top;
              w.style.right=savedPos.right; w.style.bottom=savedPos.bottom;
              w.style.width=savedPos.width; w.style.height=savedPos.height;
              savedPos=null;
            }
          }
          w.classList.add('minimized');
        }
      }
      function maximizeGuest() {
        if (w.classList.contains('maximized')) {
          w.classList.remove('maximized');
          if (savedPos) {
            w.style.left=savedPos.left; w.style.top=savedPos.top;
            w.style.right=savedPos.right; w.style.bottom=savedPos.bottom;
            w.style.width=savedPos.width; w.style.height=savedPos.height;
            savedPos=null;
          }
        } else {
          savedPos = { left:w.style.left, top:w.style.top, right:w.style.right,
                       bottom:w.style.bottom, width:w.style.width, height:w.style.height };
          w.classList.add('maximized');
          w.style.left=w.style.top=w.style.right=w.style.bottom=w.style.width=w.style.height='';
        }
      }

      window.dyoOpenGuest = openGuest;

      w.addEventListener('mousedown', function() {
        window._dyoZTop = (window._dyoZTop || 9000) + 1;
        w.style.zIndex = window._dyoZTop;
      });
      if (closeBtn)  closeBtn.addEventListener('click',  closeGuest);
      if (minBtn)    minBtn.addEventListener('click',    minimizeGuest);
      if (maxBtn)    maxBtn.addEventListener('click',    maximizeGuest);
      if (reloadBtn) reloadBtn.addEventListener('click', function() { loaded=false; loadGuest(); });
      if (sendBtn)   sendBtn.addEventListener('click', sendGuest);
      chat.addEventListener('click', function(e) {
        var editBtn = e.target.closest('.dyo-chat-editbtn');
        if (editBtn) {
          var bwrap = editBtn.closest('.dyo-chat-bwrap');
          if (bwrap) editGuest(editBtn.dataset.id, bwrap);
          return;
        }
        var delBtn = e.target.closest('.dyo-chat-delbtn');
        if (delBtn) {
          var bwrap = delBtn.closest('.dyo-chat-bwrap');
          if (bwrap) deleteGuest(delBtn.dataset.id, bwrap);
        }
      });
      if (textarea) {
        textarea.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) { e.preventDefault(); sendGuest(); }
        });
      }

      if (titlebar) {
        titlebar.addEventListener('dblclick', function(e) {
          if (e.target===closeBtn||e.target===minBtn||e.target===maxBtn) return;
          maximizeGuest();
        });
        titlebar.addEventListener('mousedown', function(e) {
          if (w.classList.contains('maximized')) return;
          if (e.target===closeBtn||e.target===minBtn||e.target===maxBtn) return;
          var r = w.getBoundingClientRect();
          w.style.left=r.left+'px'; w.style.top=r.top+'px';
          w.style.right='auto'; w.style.bottom='auto';
          dragging=true; dragOX=e.clientX-r.left; dragOY=e.clientY-r.top;
          e.preventDefault();
        });
        titlebar.addEventListener('touchstart', function(e) {
          if (w.classList.contains('maximized')) return;
          var t=e.touches[0], r=w.getBoundingClientRect();
          w.style.left=r.left+'px'; w.style.top=r.top+'px';
          w.style.right='auto'; w.style.bottom='auto';
          dragging=true; dragOX=t.clientX-r.left; dragOY=t.clientY-r.top;
        }, {passive:true});
      }

      document.addEventListener('mousemove', function(e) {
        if (dragging) {
          var x=Math.max(0,Math.min(window.innerWidth-w.offsetWidth, e.clientX-dragOX));
          var y=Math.max(0,Math.min(window.innerHeight-40, e.clientY-dragOY));
          w.style.left=x+'px'; w.style.top=y+'px';
        }
        if (resizing) {
          var dx=e.clientX-resizeSX, dy=e.clientY-resizeSY, r=resizeSRect;
          var nL=r.left,nT=r.top,nW=r.width,nH=r.height;
          if (resizeDir.indexOf('e')!==-1) nW=Math.max(MIN_W,r.width+dx);
          if (resizeDir.indexOf('s')!==-1) nH=Math.max(MIN_H,r.height+dy);
          if (resizeDir.indexOf('w')!==-1){nW=Math.max(MIN_W,r.width-dx);nL=r.left+r.width-nW;}
          if (resizeDir.indexOf('n')!==-1){nH=Math.max(MIN_H,r.height-dy);nT=r.top+r.height-nH;}
          w.style.left=nL+'px'; w.style.top=nT+'px';
          w.style.width=nW+'px'; w.style.height=nH+'px';
        }
      });
      document.addEventListener('touchmove', function(e) {
        if (!dragging) return;
        var t=e.touches[0];
        var x=Math.max(0,Math.min(window.innerWidth-w.offsetWidth, t.clientX-dragOX));
        var y=Math.max(0,Math.min(window.innerHeight-40, t.clientY-dragOY));
        w.style.left=x+'px'; w.style.top=y+'px';
      }, {passive:true});
      document.addEventListener('mouseup',  function(){dragging=false;resizing=false;});
      document.addEventListener('touchend', function(){dragging=false;});

      w.querySelectorAll('.dyo-brs-handle').forEach(function(handle) {
        handle.addEventListener('mousedown', function(e) {
          if (w.classList.contains('maximized')||w.classList.contains('minimized')) return;
          e.stopPropagation(); e.preventDefault();
          resizing=true; resizeDir=handle.getAttribute('data-dir');
          resizeSX=e.clientX; resizeSY=e.clientY;
          var r=w.getBoundingClientRect();
          resizeSRect={left:r.left,top:r.top,width:r.width,height:r.height};
          w.style.left=r.left+'px'; w.style.top=r.top+'px';
          w.style.width=r.width+'px'; w.style.height=r.height+'px';
          w.style.right='auto'; w.style.bottom='auto';
        });
      });
    })();
  </script>
</body>

</html>
